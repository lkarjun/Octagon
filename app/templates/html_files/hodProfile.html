{% extends "commonLayout.html" %}
{% block content %}

<script>
    $(".navUser").addClass("navisel")
</script>

<div class="ui container pt-5 pb-5">

    <form class="ui form p-4" id='Appointment_form_V2_0'>
        <h3 class="ui dividing header" style="font-family: sans-serif;">Update Details</h3>
        <div class="field">
            <label>Department</label>
            <select class="ui dropdown disabled" id='depart'>
                <option value="{{user.department}}">{{user.department}}</option>
            </select>
        </div>
        <div class="fields three">
            <div class="field">
              <label>Id</label>
              <input id='id' required type="text" placeholder="Staff ID" value="{{ user.id }}">
            </div>
            <div class="field">
              <label>Name</label>
              <input id='name' required type="text" placeholder="Name" value="{{ user.name }}">
            </div>
            <div class="field">
              <label>Email</label>
              <input id='email' required type="email" placeholder="Email" value="{{ user.email }}">
            </div>
            
          </div>
      
          <div class="fields three">
            <div class="field">
              <label>Phone Number</label>
              <input id='number' required type="number" placeholder="Phone Number" value="{{ user.phone_num }}">
            </div>
            <div class="field">
              <label>Tag</label>
              <select class="ui dropdown" id='tag'>
                  {% if user.tag == "-" %}
                  <option value="-" selected>None</option>
                  <option value="CT">Class Teacher</option>
                  <option value="TT">Tutor</option>
                  {%elif user.tag == "CT"%}
                  <option value="-">None</option>
                  <option value="CT" selected>Class Teacher</option>
                  <option value="TT">Tutor</option>
                  {%else%}
                  <option value="-">None</option>
                  <option value="CT">Class Teacher</option>
                  <option value="TT" selected>Tutor</option>
                  {%endif%}
              </select>
            </div>
            <div class="field">
              <label>Higher Qualification</label>
              <select class="ui dropdown" id='hq'>
                  {% if user.higher_qualification == "PHD" %}
                    <option value="PHD" selected>PHD</option>
                    <option value="POST DOCTORATE">POST DOCTORATE</option>
                    <option value="PH">PH</option>
                    <option value="MPHIL">MPHIL</option>
                  {% elif user.higher_qualification == "POST DOCTORATE" %}
                  <option value="PHD">PHD</option>
                  <option value="POST DOCTORATE" selected>POST DOCTORATE</option>
                  <option value="PH">PH</option>
                  <option value="MPHIL">MPHIL</option>
                  {% elif user.higher_qualification == "PH" %}
                  <option value="PHD">PHD</option>
                  <option value="POST DOCTORATE">POST DOCTORATE</option>
                  <option value="PH" selected>PH</option>
                  <option value="MPHIL">MPHIL</option>
                  {%else%}
                  <option value="PHD">PHD</option>
                  <option value="POST DOCTORATE">POST DOCTORATE</option>
                  <option value="PH">PH</option>
                  <option value="MPHIL" selected>MPHIL</option>
                  {%endif%}

              </select>
            </div>
            
          </div>
      
          <div class="fields three">
            <div class="field">
              <label>Net Qualification</label>
              <select class="ui dropdown" id='nq'>
                  {%if user.net_qualification == "Yes"%}
                    <option value="Yes" selected>Yes</option>
                    <option value="NO">No</option>
                  {% else %}
                  <option value="Yes">Yes</option>
                    <option value="NO"selected>No</option>
                  {%endif%}
              </select>
      
            </div>
            <div class="field">
              <label>Designation</label>
              <select class="ui dropdown" id='dn'>
                  {% if user.designation == "ASSISTANT PROFESSOR" %}
                  <option value="ASSISTANT PROFESSOR" selected>ASSISTANT PROFESSOR</option>
                  <option value="ASSOCIATE PROFESSOR">ASSOCIATE PROFESSOR</option>
                  <option value="CONTRACT TEACHER">CONTRACT TEACHER</option>
                  <option value="PART TIME TEACHER">PART TIME TEACHER</option>
                  {% elif user.designation == "ASSOCIATE PROFESSOR" %}
                  <option value="ASSISTANT PROFESSOR">ASSISTANT PROFESSOR</option>
                  <option value="ASSOCIATE PROFESSOR" selected>ASSOCIATE PROFESSOR</option>
                  <option value="CONTRACT TEACHER">CONTRACT TEACHER</option>
                  <option value="PART TIME TEACHER">PART TIME TEACHER</option>
                  {% elif user.designation == "CONTRACT TEACHER" %}
                  <option value="ASSISTANT PROFESSOR">ASSISTANT PROFESSOR</option>
                  <option value="ASSOCIATE PROFESSOR">ASSOCIATE PROFESSOR</option>
                  <option value="CONTRACT TEACHER" selected>CONTRACT TEACHER</option>
                  <option value="PART TIME TEACHER">PART TIME TEACHER</option>
                  {% else %}
                  <option value="ASSISTANT PROFESSOR">ASSISTANT PROFESSOR</option>
                  <option value="ASSOCIATE PROFESSOR">ASSOCIATE PROFESSOR</option>
                  <option value="CONTRACT TEACHER">CONTRACT TEACHER</option>
                  <option value="PART TIME TEACHER" selected>PART TIME TEACHER</option>
                  {%endif%}

              </select>
      
            </div>
            <div class="field">
              <label>Social Status</label>
              <select class="ui dropdown" id='sc'>
                {% if user.social_status == "GENERAL" %}
                <option value="GENERAL"selected>GENERAL</option>
                <option value="OBC">OBC</option>
                <option value="SC/ST">SC/ST</option>
                {% elif user.social_status == "OBC" %}
                <option value="GENERAL">GENERAL</option>
                <option value="OBC" selected>OBC</option>
                <option value="SC/ST">SC/ST</option>
                {%else%}
                <option value="GENERAL">GENERAL</option>
                <option value="OBC">OBC</option>
                <option value="SC/ST" selected>SC/ST</option>
                {%endif%}
              </select>
            </div>
      
          </div>
      
          <div class="fields three">
            <div class="field">
              <label>Teaching Experience</label>
              <input id='te' required type="number" placeholder="Year of Experience" value="{{user.teaching_experience}}">
            </div>
            
            <div class="field">
              <label>Gender</label>
              <select class="ui dropdown" id='gr'>
                {% if user.gender == "MALE" %}
                <option value="MALE" selected>MALE</option>
                <option value="FEMALE">FEMALE</option>
                <option value="TRANSGENDER">TRANSGENDER</option>
                {% elif user.gender == "FEMALE" %}
                <option value="MALE">MALE</option>
                <option value="FEMALE" selected>FEMALE</option>
                <option value="TRANSGENDER">TRANSGENDER</option>
                {%else%}
                <option value="MALE">MALE</option>
                <option value="FEMALE" >FEMALE</option>
                <option value="TRANSGENDER" selected>TRANSGENDER</option>
                {%endif%}
              </select>
            </div>
      
            <div class="field">
              <label>Religion</label>
              <select class="ui dropdown" id='rn'>
                {% if user.religion == "HINDU" %}
                <option value="HINDU" selected>HINDU</option>
                <option value="MUSLIM">MUSLIM</option>
                <option value="CHRISTIAN">CHRISTIAN</option>
                {% elif user.religion == "MUSLIM" %}
                <option value="HINDU">HINDU</option>
                <option value="MUSLIM" selected>MUSLIM</option>
                <option value="CHRISTIAN">CHRISTIAN</option>
                {%else%}
                <option value="HINDU">HINDU</option>
                <option value="MUSLIM">MUSLIM</option>
                <option value="CHRISTIAN" selected>CHRISTIAN</option>
                {%endif%}
              </select>
            </div>
            
          </div>
      
          <div class="fields two">
      
            <div class="field">
              <label>Date of Birth</label>
              <input id='dob' required type="date" placeholder="" value="{{user.dob}}">
            </div>
            <div class="field">
              <label>Joining Date</label>
              <input id='jdate' disabled required type="date" placeholder="Date" value="{{user.joining_date}}">
            </div>
            <div class="field" style="display: block;">
              <label>Secret Code</label>
              <input id='username' required type="password" value="1111" placeholder="4 Digit Secret Code">
            </div>
          </div>
        <button class="ui button teal" id='upload_button' type="submit">Update details</button>
    </form>

    <!-- <form class="ui form p-4" id='Appointment_form'>
        <h3 class="ui dividing header" style="font-family: sans-serif;">Update Details</h3>
        <div class="fields three">
          <div class="field">
            <label>Name</label>
            <input id='name' required type="text" placeholder="Name" value="{{ user.name }}">
          </div>
          <div class="field">
            <label>Email</label>
            <input id='email' required type="email" placeholder="Email" value="{{ user.email }}">
          </div>
          <div class="field">
            <label>Secret Code</label>
            <input id='username' required type="text" placeholder="4 Digit Secret Code" value="{{ scode }}">
          </div>
        </div>
  
        <div class="fields two">
          <div class="field">
            <label>Phone Number</label>
            <input id='number' required type="number" value="{{ user.phone_num }}">
          </div>
  
          <div class="field">
            <label>Department</label>
            <input id='department_options' required type="text" disabled value="{{ user.department }}">
          </div>
        </div>
        <button class="ui button teal" id='upload_button' type="submit">Update details</button>
    </form> -->

    <hr class='rounded' style="height: 5px; background-color: rgb(255, 0, 106);">


    <form class="ui form p-4" id='imageupdate'>
        
        <h3 class="ui dividing header" style="font-family: sans-serif;">Update Verification Image</h3>
        
        <div class="fields three">
            <div class="field">
                <label>Verification Image 1
                <input id='vimage1' required type="file" accept="image/*"capture="camera"></label>
            </div>

            <div class="field">
                <label>Verification Image 2
                  <input id='vimage2' required type="file" accept="image/*"capture="camera">
                </label>
            </div>

            <div class="field pb-2 pb-md-0">
                <label>Verification Image 3
                  <input id='vimage3' required type="file" accept="image/*"capture="camera">
                </label>
            </div>
        </div>

        <div class="pt-2 pb-4" id = 'pro' style="display: none;">
            <div class="progress" style="height: 15px;">
              <div class="progress-bar bg-success rounded" role="progressbar" style="width: 10%;" aria-valuenow="25" aria-valuemin="0" aria-valuemax="100"></div>
            </div>
        </div>

        <button class="ui button teal" id='upload_button' type="submit">Update Image</button>
  
    </form>

</div>

<script>

$("#imageupdate").submit((e) => {
    var base = window.location.origin + '/hod/verification_image';
    var form_data = new FormData()
    var username = $('#name').val().toLowerCase().slice(0,3) + String($('#number').val()).slice(7) + $('#username').val()
    form_data.append('username', username);
    form_data.append('image1', $('#vimage1')[0].files[0])
    form_data.append('image2', $('#vimage2')[0].files[0])
    form_data.append('image3', $('#vimage3')[0].files[0])
    console.log(form_data)
    $("#upload_button").addClass("loading disabled")
    $("#pro").show()
    $.ajax({
        xhr: function() {
            var xhr = new window.XMLHttpRequest();
            xhr.upload.addEventListener("progress", function(evt) {
            if (evt.lengthComputable) {
              var percentComplete = Math.round((evt.loaded / evt.total) * 100);
              $(".progress-bar").width(percentComplete + '%');
              $(".progress-bar").html(percentComplete+'%');
                }
            }, false);
            return xhr;
        },
        url: base,
        type: 'POST',
        async: true,
        data: form_data,
        cache: false,
    
        contentType: false,
        processData: false,
        beforeSend: function(){
            $(".progress-bar").width('0%');
            $('#uploadStatus').html('<img src="images/loading.gif"/>');
        },
        success: function(result){
            $("#pro").hide()
            swal({
                    text: "Verification Images Updated...",
                    icon: "success",
                    button: "Okay"
                }).then((value) => {
                    location.reload();
            })
        },
        error: function(result){
            if(result.status == 415){
                $("#upload_button").removeClass("loading disabled")
                $("#pro").hide()
                swal({
                    text: "Please retake image...",
                    icon: "warning",
                    button: "Okay"
                })
            }
            else{
                $("#pro").hide()
                swal({
                    text: "Something Went Wrong. Please try to contact the techincal team...",
                    icon: "error",
                    button: "Okay"  
                }).then((value) => {
                    location.reload();
                })   
            }
      
        }
    })
})

</script>

<script>
    $("#Appointment_form_V2_0").submit((e)=>{
        var name = $('#name').val()
        var email = $('#email').val()
        var phone = parseInt($('#number').val())
        var username = make_username(name, phone)
        var department = $('#depart').val()
        var jdate = $("#jdate").val().toString()
        var dob = $("#dob").val().toString()
        var sc = $("#sc").val()
        var te = $("#te").val()
        var rn = $("#rn").val()
        var gr = $("#gr").val()
        var hq = $("#hq").val()
        var nq = $("#nq").val()
        var dn = $("#dn").val()
        var id = $("#id").val()
        var tag = $("#tag").val()
    
        var data = JSON.stringify({"id": id, "name": name, "email": email,
                    "phone_num": phone, 
                    "username": username,
                    "department": department,
                    "tag": tag, "joining_date": jdate, "dob": dob,
                    "higher_qualification": hq, "net_qualification": nq,
                    "designation": dn, "gender": gr, "teaching_experience": te,
                    "religion": rn, "social_status": sc});
 
        var base = window.location.origin + '/hod/update_profile';
        $("#upload_button").addClass("loading disabled")
        $.ajax({
            url: base,
            type: 'POST',
            async: true,
            data: data,
            dataType: 'json',
            contentType: "application/json",
            
            success: function(result){
                swal({
                    text: "Profile updated!",
                    icon: "success",
                    button: "Okay"
                }).then((value) => {
                    window.location.href = window.location.origin;
                })
            },
            error: function(result){
                $("#upload_button").removeClass("loading disabled")
                swal("Not working fine")
            }
        })
    })

    function make_username(name, phone){
        var username = $('#username').val()
        var username = name.replaceAll(/\s/g,'').toLowerCase().slice(0,3) + String(phone).slice(7) + username
        return username
      }
</script>

{% endblock %}