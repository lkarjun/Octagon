{% if who %}
{% extends "commonLayout.html" %}
{% else %}
{% extends "teacherLayout.html" %}
{% endif %}

{% block content %}

<script>
$("#navMore").addClass("navisel")
$("#navStudw").addClass("navisel")
$("#navStudm").addClass("navisel")
</script>

<div class="container">

    <section id="head">
        <div class="row">
    
            <div class="col-md-12">
                <div class="text-center pt-5 pr-5 pl-3">
                    <div class="ui buttons small">
                        <button class="ui button animated teal "onclick="show('#New')">
                            <div class="visible content">New</div>
                            <div class="hidden content">
                                <i class="edit outline icon"></i>
                            </div>
                        </button>
                        <button class="ui button animated blue "onclick="show('#Edit')">
                            <div class="visible content">Edit</div>
                            <div class="hidden content">
                                <i class="edit outline icon"></i>
                            </div>
                        </button>
                        <button class="ui button red animated" onclick="show('#Remove')">
                            <div class="visible content">Remove</div>
                            <div class="hidden content">
                                <i class="trash icon"></i>
                            </div>
            
                        </button>
                    </div>
                </div>
            </div>
            <script>
                function show(id){
                    $("#New").hide();
                    $("#Edit").hide();
                    $("#Remove").hide();
                    $(id).show();
    
                }
            </script>
        </div>
    </section>
    
    <section id="New" class="p-md-5 m-md-5 pb-5 pt-5" style="display: block;">
        
        <form class="ui form" id="course_year_detail">
            <h3 class="ui dividing header" style="font-family: sans-serif">Choose Course and Year</h3>
            <br>
            <div class="two fields">
                
                <div class="field">
                    <label >Choose Course</label>
                    <select required class="ui dropdown search" id='course'>
                        <option value="" disabled selected>Choose valid option</option>
                        {% if course %}
                        {% for i in course %}
                        <option value='{{ i["Course_name_alias"] }}'>{{i['Course_name']}}</option>
                        {% endfor %}
                        {% else %}
                        <option value="none">None</option>
                        {% endif %}
                    </select>
                </div>
    
                <div class="field">
                    <label>Choose Year</label>
                    <select class="ui dropdown" id="year">
                        <option value="1" selected>Year 1</option>
                        <option value="2">Year 2</option>
                        <option value="3">Year 3</option>
                        <option value="4">Year 4</option>
                        <option value="5">Year 5</option>
                    </select>
                </div>
    
            </div>
        </form>
        <br>
        <br>

        <div class="text-center">
            <div class="ui buttons">
                <button class="ui button" onclick="$('#upload_file').show();$('#NewStudent_v2_0').hide();">Upload Csv/Xlsx File</button>
                <div class="or"></div>
                <button class="ui positive button" onclick="$('#NewStudent_v2_0').show();$('#upload_file').hide();">Enter Manually</button>
            </div>
        </div>

        <br>

        <form class="ui form" id="NewStudent_v2_0" style="display: none;">
            <br>
            <h3 class="ui dividing header" style="font-family: sans-serif">Enter Student Details</h3>
    
            <div class="fields two">
                <div class="field">
                    <label for="unique_id">Admission No:</label>
                    <input required type="text" id="unique_id" placeholder="Admission Number">
                </div>

                <div class="field">
                    <label for="unique_id">Registration No:</label>
                    <input type="text" id="r_number" value = "None" placeholder="Registration Number">
                </div>
            </div>

            <div class="three fields">
<!--             
                <div class="field">
                    <label for="unique_id">Admission No:</label>
                    <input required type="text" id="unique_id" placeholder="Admission Number">
                </div> -->
    
                <div class="field">
                    <label for="name">Name: </label>
                    <input required type="text" id="name" placeholder="Full Name">
                </div>
    
                <div class="field">
                    <label>Gender</label>
                    <select class="ui dropdown" id='gr'>
                      <option value="Male">MALE</option>
                      <option value="Female">FEMALE</option>
                      <option value="Transgender">TRANSGENDER</option>
                    </select>
                  </div>
                  
                  <div class="field">
                    <label>Parent Number:</label>
                    <input required type='number' id='parent_number' placeholder="Parent Phone Number">
                </div>

            </div>
    
            <div class="three fields">
    
                <!-- <div class="field">
                    <label>Parent Number:</label>
                    <input required type='number' id='parent_number' placeholder="Parent Phone Number">
                </div> -->
                
                
                <div class="field">
                    <label>Religion:</label>
                    <select class="ui dropdown" id='rn'>
                        <option value="Hindu">HINDU</option>
                        <option value="Muslim">MUSLIM</option>
                        <option value="Christian">CHRISTIAN</option>
                    </select>
                </div>

                <div class="field">
                    <label>Social Status:</label>
                    <select class="ui dropdown" id='sc'>
                      <option value="General">GENERAL</option>
                      <option value="Obc">OBC</option>
                      <option value="Sc/St">SC/ST</option>
                    </select>
                </div>

                <div class="field">
                    <label>State:</label>
                    <select class="ui dropdown" id='state'>
                      <option value="Kerala">Kerala</option>
                      <option value="Outside Kerala">Outside Kerala</option>
                      <option value="Foreign">Foreign</option>
                      <option value="Nri">NRI</option>
                    </select>
                </div>
            
            </div>
        
        
            <div class="ui buttons">
                <button class="ui button green" type="submit" id="appoint_btn">Submit</button>
                <div class="or"></div>
                <div class="ui button red" onclick='$("#NewStudent")[0].reset();'>clear</div>
            </div>

        </form>

        <!-- <form class="ui form" id="NewStudent" style="display: none;">
            <br>
            <h3 class="ui dividing header" style="font-family: sans-serif">Enter Student Details</h3>
    
            <div class="three fields">
            
                <div class="field">
                    <input required type="text" id="unique_id" placeholder="Unique Id">
                </div>
    
                <div class="field">
                    <input required type="text" id="name" placeholder="Full Name">
                </div>
    
                <div class="field">
                    <input required type="email" id="email" placeholder="Email">
                </div>
    
            </div>
    
            <div class="three fields">
    
                <div class="field">
                    <input required type="text" id="parent_name" placeholder="Parent Name">
                </div>
    
                <div class="field">
                    <input required type='number' id='parent_number' placeholder="Parent Phone Number">
                </div>
                
                <div class="field">
                    <input required type='number' id='number' placeholder="Phone Number 2">
                </div>
            
            </div>
        
            <div class="two fields">
                
                <div class="field">
                    <label >Choose Course</label>
                    <select required class="ui dropdown search" id='course'>
                        <option value="" disabled selected>Choose valid option</option>
                        {% if course %}
                        {% for i in course %}
                        <option value='{{ i["Course_name_alias"] }}'>{{i['Course_name']}}</option>
                        {% endfor %}
                        {% else %}
                        <option value="none">None</option>
                        {% endif %}
                    </select>
                </div>
    
                <div class="field">
                    <label>Choose Year</label>
                    <select class="ui dropdown" id="year">
                        <option value="1" selected>Year 1</option>
                        <option value="2">Year 2</option>
                        <option value="3">Year 3</option>
                        <option value="4">Year 4</option>
                        <option value="5">Year 5</option>
                    </select>
                </div>
    
            </div>

            <div class="ui buttons">
                <button class="ui button green" type="submit" id="appoint_btn">Submit</button>
                <div class="or"></div>
                <div class="ui button red" onclick='$("#NewStudent")[0].reset();'>clear</div>
            </div>

        </form> -->
        <br><br>

        <div id="upload_file" style="display: none;">

            <form class="ui form" id="upload_file_form">
                <h3 class="ui dividing header" style="font-family: sans-serif">Upload Csv or XLSM File</h3>
                <div class="field">
                    <label for="file" class="ui icon button yellow w-50">
                        <i class="file icon"></i>
                            Add CSV/XLSM File
                    </label>
                    <input type="file" id="file" style="display:none;" required accept=".csv, .xlxm, .xls">
                </div>
                
                <div class="pt-2 pb-4" id = 'pro' style="display: none;">
                    <div class="progress" style="height: 15px;">
                    <div class="progress-bar bg-success rounded" role="progressbar" style="width: 10%;" aria-valuenow="25" aria-valuemin="0" aria-valuemax="100"></div>
                    </div>
                </div>
                <button class="ui button green" type="submit" id="upload_btn" >Upload File</button>
            </form>

        </div>

    </section>
    
    <section id="Edit" class="p-md-5 m-md-5 pb-5 pt-5" style="display: none;">

        <form class="ui form pb-md-5 pb-5" id="editVerify_V2">
            <h3 class="ui dividing header" style="font-family: sans-serif">Verify First</h3>
            <div class="three fields">

                <div class="field">
                    <label >Unique Id</label>
                    <input type="text" id="id2" required placeholder="Unique Id">
                </div>

                <div class="field">
                    <label >Choose Course</label>
                    <select class="ui dropdown" required id='edCourse1'></select>
                </div>
    
                <div class="field">
                    <label>Choose Year</label>
                    <select class="ui dropdown" id='edYear1'>
                        <option value="1" selected>Year 1</option>
                        <option value="2">Year 2</option>
                        <option value="3">Year 3</option>
                        <option value="4">Year 4</option>
                        <option value="5">Year 5</option>
                    </select>
                </div>
            </div>
            <div class="ui buttons w-50">
                <button class="ui button teal" id = 'appoint_btn2' type="submit">Verify</button>
                <div class="or"></div>
                <div class="ui button yellow" onclick='reset_edit()'>clear</div>
            </div>
        </form>

        <form class="ui form" id="editstudent_V2">
            <h3 class="ui dividing header" style="font-family: sans-serif">Edit Student Details</h3>
    
            <!-- <div class="three fields">
            
                <div class="field">
                    <input type="text" name="unique_id" id='id4' placeholder="Unique Id">
                </div>
                <div class="field">
                    <input type="text" name="reg_number" id='id4' placeholder="Unique Id">
                </div>
    
                <div class="field">
                    <input type="text" name="name" id='name4' placeholder="Full Name">
                </div>
    
                <div class="field">
                    <input type="email" name="email" id='email4' placeholder="Email">
                </div>
    
            </div>
    
            <div class="three fields">
    
                <div class="field">
                    <input type="text" name="pname" id='pname4' placeholder="Parent Name">
                </div>
    
                <div class="field">
                    <input type='text' name='pnumber' id='pnumber4' placeholder="Parent Phone Number">
                </div>
                
                <div class="field">
                    <input type='text' name='snumber' id='snumber4' placeholder="Phone Number 2">
                </div>
            
            </div> -->
        
            <div class="fields two">
                <div class="field">
                    <label for="unique_id">Admission No:</label>
                    <input required type="text" id="edunique_id" placeholder="Admission Number">
                </div>

                <div class="field">
                    <label for="unique_id">Registration No:</label>
                    <input type="text" id="edr_number" value = "None" placeholder="Registration Number">
                </div>
            </div>

            <div class="three fields">
<!--             
                <div class="field">
                    <label for="unique_id">Admission No:</label>
                    <input required type="text" id="unique_id" placeholder="Admission Number">
                </div> -->
    
                <div class="field">
                    <label for="name">Name: </label>
                    <input required type="text" id="edname" placeholder="Full Name">
                </div>
    
                <div class="field">
                    <label>Gender</label>
                    <select class="ui dropdown" id='edgr'>
                      <option value="Male">MALE</option>
                      <option value="Female">FEMALE</option>
                      <option value="Transgender">TRANSGENDER</option>
                    </select>
                  </div>
                  
                  <div class="field">
                    <label>Parent Number:</label>
                    <input required type='number' id='edparent_number' placeholder="Parent Phone Number">
                </div>

            </div>
    
            <div class="three fields">
    
                <!-- <div class="field">
                    <label>Parent Number:</label>
                    <input required type='number' id='parent_number' placeholder="Parent Phone Number">
                </div> -->
                
                
                <div class="field">
                    <label>Religion:</label>
                    <select class="ui dropdown" id='edrn1'>
                        <option value="Hindu">HINDU</option>
                        <option value="Muslim">MUSLIM</option>
                        <option value="Christian">CHRISTIAN</option>
                    </select>
                </div>

                <div class="field">
                    <label>Social Status:</label>
                    <select class="ui dropdown" id='edsc'>
                      <option value="General">GENERAL</option>
                      <option value="Obc">OBC</option>
                      <option value="SC/ST">SC/ST</option>
                    </select>
                </div>

                <div class="field">
                    <label>State:</label>
                    <select class="ui dropdown" id='edstate'>
                      <option value="Kerala">Kerala</option>
                      <option value="Outside Kerala">Outside Kerala</option>
                      <option value="Foreign">Foreign</option>
                      <option value="Nri">NRI</option>
                    </select>
                </div>
            
            </div>

            <div class="two fields">
                
                <div class="field">
                    <label >Choose Course</label>
                    <select class="ui dropdown" id='course4'></select>
                </div>
    
                <div class="field">
                    <label>Choose Year</label>
                    <select class="ui dropdown" id='year4'>
                        <option value="1" selected>Year 1</option>
                        <option value="2">Year 2</option>
                        <option value="3">Year 3</option>
                        <option value="4">Year 4</option>
                        <option value="5">Year 5</option>
                    </select>
                </div>
    
            </div>
            <button class="ui button teal disabled edbtndis w-100" id="appoint_btn_ed" type="submit">Submit</button>
<!-- 
            <div class="ui buttons">
                <div class="or"></div>
                <div class="ui button red disabled edbtndis" onclick='$("#editstudent")[0].reset();'>clear</div>
            </div> -->

        </form>

        <br><br>
    </section>

    <section id="Remove" class="p-md-5 m-md-5 pb-5 pt-5" style="display: none;">
        
        <form class="ui form pb-md-5 pb-5" id="removeStudent_V2">
            <h3 class="ui dividing header" style="font-family: sans-serif">Remove Student</h3>
            <div class="three fields">

                <div class="field">
                    <label >Unique Id</label>
                    <input type="text" id="id1" required placeholder="Unique Id">
                </div>

                <!-- <div class="field">
                    <label>Full Name</label>
                    <input type="text" id="rmName" required placeholder="Name">
                </div> -->

                <div class="field">
                    <label >Choose Course</label>
                    <select class="ui dropdown" id='course1'></select>
                </div>
    
                <div class="field">
                    <label>Choose Year</label>
                    <select class="ui dropdown" id='year1'>
                        <option value="1" selected>Year 1</option>
                        <option value="2">Year 2</option>
                        <option value="3">Year 3</option>
                        <option value="4">Year 4</option>
                        <option value="5">Year 5</option>
                    </select>
                </div>
            </div>
            <div class="ui buttons w-100">
                <button class="ui button orange" type="submit" id="appoint_btn1">Remove</button>
                <div class="or"></div>
                <div class="ui button red" onclick='$("#removeStudent_V2")[0].reset();'>clear</div>
            </div>
        </form>

    </section>
    <br><br>
</div>

<script>
    $('#course option').clone().appendTo('#edCourse1');
    $('#course option').clone().appendTo('#course1');
    $('#course option').clone().appendTo('#course4');
</script>

<script>
    $("#upload_file_form").submit((e)=>{
        e.preventDefault()
        var form_data = new FormData()
        form_data.append("course", $("#course").val())
        form_data.append("year", parseInt($("#year").val()))
        form_data.append('DATA', $('#file')[0].files[0])
        $("#upload_btn").addClass("loading disabled")

        var base = window.location.origin + '/teacher/add-students-from-file-v2.0';
        $("#pro").show()
        $.ajax({

            xhr: function() {
                var xhr = new window.XMLHttpRequest();
                xhr.upload.addEventListener("progress", function(evt) {
                if (evt.lengthComputable) {
                  var percentComplete = Math.round((evt.loaded / evt.total) * 100);
                  $(".progress-bar").width(percentComplete + '%');
                  $(".progress-bar").html(percentComplete+'%');
                    }
                }, false);
                return xhr;
            },
            url: base,
            type: 'POST',
            data: form_data,
            cache: false,
        
            contentType: false,
            processData: false,
            beforeSend: function(){
                $(".progress-bar").width('0%');
                $('#uploadStatus').html('<img src="images/loading.gif"/>');
            },
            success: function(result){
                $("#pro").hide()
                $("#upload_btn").removeClass("loading disabled")
                swal({
                        text: "Appointed Students",
                        icon: "success",
                        button: "Okay"
                    }).then((value) => {
                        location.reload();
                })
            },

            error: function(result){
                if(result.status == 415){
                    $("#pro").hide()
                    $("#upload_btn").removeClass("loading disabled")
                    swal({
                        text: "Unsupported Format, Supported Formats: csv, xlsm, xls",
                        icon: "warning",
                        button: "Okay"
                    })
                }
            }

        });
    })
</script>


<script>
    $("#NewStudent_v2_0").submit((e)=>{
        e.preventDefault()
        $("#appoint_btn").addClass("loading");
        var name = $("#name").val()
        var data = JSON.stringify({
                        "unique_id": $("#unique_id").val(),
                        "reg_number": $("#r_number").val(),
                        "name": name, "gender": $("#gr").val(),
                        "parent_phone": parseInt($("#parent_number").val()),
                        "state": $("#state").val(),
                        "religion": $("#rn").val(),
                        "social_status": $("#sc").val(),
                        "course": $("#course").val(), "year": parseInt($("#year").val())
                    });
        var base = window.location.origin + '/teacher/add-students-v2-0';
    
        $.ajax({
    
            url: base,
            type: 'POST',
            data: data,
            dataType: 'json',
            contentType: "application/json",
            
            success: function(result){
                $("#appoint_btn").removeClass("loading");
                swal({
                    title: "Added Student!",
                    text: "Sucessfully Added Student: " + name,
                    icon: "success",
                    button: "Okay!",
                }).then((value) => {location.reload();});
            },
            error: function(result){
                $("#appoint_btn").removeClass("loading")
                error_alert("Something Went Wrong. Please try to contact the techincal team...");
            }
    
        })
    })
    
</script>

<script src="{{ url_for('static', path='students.js') }}"></script>

<script>

    function reset_edit(){
        $("#editVerify_V2")[0].reset();
        $("#appoint_btn2").removeClass("disabled")
        $("#editstudent_V2")[0].reset()
        $(".edbtndis").addClass("disabled")
    }
    

    function set_details(data){
        console.log(data.name)
        $("#edunique_id").val(data.unique_id)
        $("#edr_number").val(data.reg_number)
        $("#edname").val(data.name)
        $("#edrn1").val(data.religion).change()
        $("#edgr").val(data.gender).change()
        $("#edstate").val(data.state).change()
        $("#edsc").val(data.social_status).change()
        $("#edparent_number").val(data.parent_phone)
        $("#course4").val(data.course).change()
        $("#year4").val(data.year).change()
        $(".edbtndis").removeClass("disabled")
    }

    $("#editVerify_V2").submit((e)=>{
        e.preventDefault();
        $("#appoint_btn2").addClass("loading disabled");
        var name = $("#id2").val()
        var data = JSON.stringify(
            {"unique_id": $("#id2").val(),
            "course": $("#edCourse1").val(), "year": parseInt($("#edYear1").val())}
        );
        
        var base = window.location.origin + '/teacher/edit-student';
    
        $.ajax({
    
            url: base,
            type: 'POST',
            data: data,
            dataType: 'json',
            contentType: "application/json",
            success: function(result){
                $("#appoint_btn2").removeClass("loading disabled");
                $("#appoint_btn2").addClass("disabled")
                set_details(result)
                console.log(result)
            },
            error: function(result){
                $("#appoint_btn2").removeClass("loading disabled");
                if(result.status == 404){
                    swal({
                        title: "Not Found!",
                        text: name + " details not found in database",
                        icon: "error",
                        button: "Okay!",
                    })
                }
                else{
                    swal({
                        title: "Error!",
                        text: "Something Went Wrong. Please try to contact the techincal team...",
                        icon: "error",
                        button: "Okay!",
                    })
                   // error_alert("Something Went Wrong. Please try to contact the techincal team...");
                }
            }
        })
    })


    $("#editstudent_V2").submit((e)=>{
        e.preventDefault();
    
        $("#appoint_btn_ed").addClass("loading disabled");
        var name = $("#edname").val()
        var data = JSON.stringify({
                        "old_unique_id": $("#id2").val(),
                        "old_course": $("#edCourse1").val(),
                        "old_year": parseInt($("#edYear1").val()),
                        "unique_id": $("#edunique_id").val(),
                        "reg_number": $("#edr_number").val(),
                        "name": name, "gender": $("#edgr").val(),
                        "parent_phone": parseInt($("#edparent_number").val()),
                        "state": $("#edstate").val(),
                        "religion": $("#edrn1").val(),
                        "social_status": $("#edsc").val(),
                        "course": $("#course4").val(), 
                        "year": parseInt($("#year4").val())
                    });
        //alert(data)
        var base = window.location.origin + '/teacher/edit-student';
    
        $.ajax({
    
            url: base,
            type: 'PUT',
            data: data,
            dataType: 'json',
            contentType: "application/json",
            success: function(result){
                $("#appoint_btn_ed").removeClass("loading disabled");
                swal({
                    title: "Updated Student Details!",
                    text: "Sucessfully Updated Student: " + name,
                    icon: "success",
                    button: "Okay!",
                }).then((value) => {location.reload();});
            },
            error: function(result){
                $("#appoint_btn_ed").removeClass("loading disabled");
                if(result.status == 404){
                    swal({
                        title: "Not Found!",
                        text: name + "details not found in database",
                        icon: "error",
                        button: "Okay!",
                    })
                }
                else{
                    swal({
                        title: "Error!",
                        text: "Something Went Wrong. Please try to contact the techincal team...",
                        icon: "error",
                        button: "Okay!",
                    })
                }
            }
        })
    })


    $("#removeStudent_V2").submit((e)=>{
        e.preventDefault();
        $("#appoint_btn1").addClass("loading disabled");
        var name = $("#id1").val()
        var data = JSON.stringify(
                    {"unique_id": $("#id1").val(),
                    "course": $("#course1").val(), "year": parseInt($("#year1").val())}
                );
        var base = window.location.origin + '/teacher/delete-student';
    
        $.ajax({
    
            url: base,
            type: 'DELETE',
            data: data,
            dataType: 'json',
            contentType: "application/json",
            success: function(result){
    
                $("#appoint_btn1").removeClass("loading disabled");
                swal({
                    title: "Removed Student!",
                    text: "Sucessfully Remove Student: " + name,
                    icon: "success",
                    button: "Okay!",
                }).then((value) => {location.reload();});
            
            },
            error: function(result){
                if(result.status == 404){
                    swal({
                        title: "Not Found!",
                        text: name + " not found in database",
                        icon: "error",
                        button: "Okay!",
                    })
                    $("#appoint_btn1").removeClass("loading disabled");
                }
                else{
                    $("#appoint_btn1").removeClass("loading disabled");
                    swal({
                        title: "Error!",
                        text: "Something Went Wrong. Please try to contact the techincal team...",
                        icon: "error",
                        button: "Okay!",
                    })
                }
            }
        })
    
    })
</script>
{% endblock %}